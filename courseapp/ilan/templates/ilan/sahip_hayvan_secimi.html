{% extends 'ana.html' %}
{% load static %}

{% block baslik %}Hayvan Seçimi - PetSafe Hub{% endblock %}

{% block css_dosyalar %}
<style>
.hayvan-secim-container{min-height:60vh;padding:40px 0}
.page-header{background:linear-gradient(135deg,#5B9BD5 0%,#70C1B3 100%);padding:40px;border-radius:20px;color:#fff;margin-bottom:40px;box-shadow:0 8px 24px rgba(91,155,213,.25);text-align:center}
.page-header h1{font-size:2.5rem;font-weight:700;margin:0 0 10px 0;text-shadow:0 2px 8px rgba(0,0,0,.2)}
.page-header p{font-size:1.1rem;margin:0;opacity:.95}
.hayvan-kart{background:rgba(255,255,255,.95);border-radius:20px;border:none;box-shadow:0 8px 24px rgba(91,155,213,.12);transition:all .3s ease;overflow:hidden;height:100%;cursor:pointer}
.hayvan-kart:hover{transform:translateY(-8px);box-shadow:0 12px 32px rgba(91,155,213,.18)}
.card-img-top-container{height:250px;overflow:hidden;position:relative}
.card-img-top{height:100%;object-fit:cover;width:100%;transition:transform .3s ease}
.hayvan-kart:hover .card-img-top{transform:scale(1.05)}
.hayvan-kart .card-body{padding:25px}
.hayvan-kart .card-title{font-weight:700;font-size:1.3rem;color:#2d3436;margin-bottom:5px}
.hayvan-kart .small{font-size:.9rem}
.hayvan-sec-btn{background:linear-gradient(135deg,#5B9BD5 0%,#70C1B3 100%);border:none;padding:12px 24px;border-radius:50px;font-weight:600;transition:all .3s ease;box-shadow:0 4px 12px rgba(91,155,213,.3)}
.hayvan-sec-btn:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(91,155,213,.4)}
.empty-state{text-align:center;padding:80px 40px;background:rgba(255,255,255,.8);border-radius:20px;margin:40px 0}
.empty-state i{font-size:5rem;color:#b2bec3;margin-bottom:20px;opacity:.5}
.btn-success{background:linear-gradient(135deg,#6FCF97 0%,#52B788 100%);border:none;padding:16px 40px;border-radius:50px;font-weight:600;transition:all .3s ease;box-shadow:0 6px 20px rgba(111,207,151,.3)}
.btn-success:hover{transform:translateY(-3px);box-shadow:0 10px 30px rgba(111,207,151,.4)}
.modal-content{border-radius:20px;border:none;box-shadow:0 10px 40px rgba(0,0,0,.15)}
.modal-header{background:linear-gradient(135deg,#5B9BD5 0%,#70C1B3 100%);color:#fff;border-radius:20px 20px 0 0;border:none;padding:20px 30px}
.modal-title{font-weight:600;font-size:1.2rem}
.modal-body{padding:30px}
.modal-footer{border:none;padding:20px 30px}
.btn-secondary{background:rgba(108,117,125,.95);border:none;padding:12px 30px;border-radius:50px;font-weight:600;transition:all .3s ease}
.btn-secondary:hover{transform:translateY(-2px);background:#6c757d;box-shadow:0 6px 20px rgba(108,117,125,.3)}
.btn-primary{background:linear-gradient(135deg,#5B9BD5 0%,#70C1B3 100%);border:none;padding:12px 30px;border-radius:50px;font-weight:600;transition:all .3s ease;box-shadow:0 6px 20px rgba(91,155,213,.3)}
.btn-primary:hover{transform:translateY(-3px);box-shadow:0 10px 30px rgba(91,155,213,.4)}
@media(max-width:768px){.page-header{padding:30px 20px}.page-header h1{font-size:1.8rem}}
</style>
{% endblock %}

{% block icerik %}
<div class="hayvan-secim-container">
    <div class="container">
        <div class="page-header">
            <h1><i class="fas fa-paw me-3"></i>Hayvan Seçimi</h1>
            <p>İlan vermek için bir hayvan seçin veya yeni hayvan ekleyin</p>
        </div>

            <!-- Hayvan Listesi -->
            {% if evcil_hayvanlar %}
                <div class="row">
                    {% for hayvan in evcil_hayvanlar %}
                    <div class="col-lg-4 col-md-6 mb-4">
                        <div class="card h-100 shadow-sm hayvan-kart" data-hayvan-id="{{ hayvan.id }}">
                            <!-- Hayvan Resmi -->
                            <div class="card-img-top-container" style="height: 250px; overflow: hidden;">
                                {% if hayvan.resim %}
                                    <img src="{{ hayvan.resim.url }}" 
                                         alt="{{ hayvan.ad }}" 
                                         class="card-img-top" 
                                         style="height: 100%; object-fit: cover;">
                                {% else %}
                                    <div class="card-img-top d-flex align-items-center justify-content-center bg-light" 
                                         style="height: 100%;">
                                        <i class="fas fa-paw fa-3x text-muted"></i>
                                    </div>
                                {% endif %}
                            </div>

                            <!-- Hayvan Bilgileri -->
                            <div class="card-body d-flex flex-column">
                                <div class="mb-3">
                                    <h5 class="card-title mb-1">{{ hayvan.ad }}</h5>
                                    <p class="text-muted small mb-2">
                                        <i class="fas fa-paw me-1"></i>{{ hayvan.tur.ad }} - {{ hayvan.irk.ad }}
                                    </p>
                                </div>

                                <div class="mb-3">
                                    <div class="row text-center">
                                        <div class="col-6">
                                            <small class="text-muted d-block">Doğum Tarihi</small>
                                            <strong class="small">{{ hayvan.dogum_tarihi|date:"d.m.Y"|default:"Bilinmiyor" }}</strong>
                                        </div>
                                        <div class="col-6">
                                            <small class="text-muted d-block">Cinsiyet</small>
                                            <strong class="small">{{ hayvan.get_cinsiyet_display }}</strong>
                                        </div>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <p class="text-muted small mb-1">
                                        <i class="fas fa-user me-1"></i>
                                        Sahip: {{ hayvan.sahip.ad }} {{ hayvan.sahip.soyad }}
                                    </p>
                                    {% if hayvan.kayip_durumu %}
                                    <p class="text-danger small mb-0">
                                        <i class="fas fa-exclamation-triangle me-1"></i>
                                        Kayıp Durumunda
                                    </p>
                                    {% endif %}
                                </div>

                                <!-- Hayvan Notları -->
                                {% if hayvan.genel_not %}
                                <div class="mb-3 flex-grow-1">
                                    <p class="card-text small text-muted">
                                        {{ hayvan.genel_not|truncatewords:15 }}
                                    </p>
                                </div>
                                {% endif %}

                                <!-- Seç Butonu -->
                                <div class="mt-auto">
                                    <button class="btn btn-primary w-100 hayvan-sec-btn" data-hayvan-id="{{ hayvan.id }}">
                                        <i class="fas fa-check me-2"></i>Bu Hayvanı Seç
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>

        {% else %}
            <!-- Hayvan Yok veya Tüm Hayvanlar İlan Verilmiş -->
            <div class="empty-state">
                <i class="fas fa-paw"></i>
                {% if ilan_verilmis_hayvan_sayisi > 0 %}
                    <h3 class="text-muted mb-3">Tüm Hayvanlarınız İçin İlan Verilmiş</h3>
                    <p class="text-muted mb-4">Mevcut hayvanlarınızın hepsi için zaten aktif ilanlar bulunmaktadır. Yeni hayvan ekleyerek ilan verebilirsiniz.</p>
                {% else %}
                    <h3 class="text-muted mb-3">Henüz hayvan profiliniz yok</h3>
                    <p class="text-muted mb-4">İlan vermek için önce hayvan profili oluşturmalısınız</p>
                {% endif %}
            </div>
        {% endif %}

        <!-- Yeni Hayvan Ekleme Butonu -->
        <div class="text-center mt-4">
            <a href="{% url 'ilan:hayvan_profili_olustur' %}" class="btn btn-success btn-lg">
                <i class="fas fa-plus me-2"></i>Yeni Hayvan Ekle
            </a>
        </div>
    </div>
</div>

<!-- Seçilen Hayvan Bilgileri Modal -->
<div class="modal fade" id="hayvanSecimModal" tabindex="-1" aria-labelledby="hayvanSecimModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="hayvanSecimModalLabel">
                    <i class="fas fa-paw me-2"></i>Hayvan Seçimi Onayı
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-4">
                        <div id="modal-hayvan-resim" class="text-center">
                            <!-- Hayvan resmi buraya gelecek -->
                        </div>
                    </div>
                    <div class="col-md-8">
                        <h5 id="modal-hayvan-adi" class="mb-2"></h5>
                        <div class="row mb-2">
                            <div class="col-6">
                                <small class="text-muted d-block">Tür</small>
                                <strong id="modal-hayvan-tur"></strong>
                            </div>
                            <div class="col-6">
                                <small class="text-muted d-block">Irk</small>
                                <strong id="modal-hayvan-irk"></strong>
                            </div>
                        </div>
                        <div class="row mb-2">
                            <div class="col-6">
                                <small class="text-muted d-block">Yaş</small>
                                <strong id="modal-hayvan-yas"></strong>
                            </div>
                            <div class="col-6">
                                <small class="text-muted d-block">Cinsiyet</small>
                                <strong id="modal-hayvan-cinsiyet"></strong>
                            </div>
                        </div>
                        <div class="mb-2">
                            <small class="text-muted d-block">Konum</small>
                            <strong id="modal-hayvan-konum"></strong>
                        </div>
                        <p class="text-muted small mb-0" id="modal-hayvan-aciklama"></p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">İptal</button>
                <button type="button" class="btn btn-primary" id="onayla-hayvan-secimi">
                    <i class="fas fa-check me-2"></i>Bu Hayvanı Seç ve İlan Oluştur
                </button>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Hayvan seç butonları
    document.querySelectorAll('.hayvan-sec-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const hayvanId = this.getAttribute('data-hayvan-id');
            
            // Direkt ilan oluşturma sayfasına yönlendir
            if (hayvanId) {
                window.location.href = `/ilanlar/sahip-ilan-olustur/${hayvanId}/`;
            }
        });
    });
});
</script>
{% endblock %}
