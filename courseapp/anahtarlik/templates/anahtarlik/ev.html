{% extends 'ana.html' %}
{% load static %}
{% block baslik %}<title>PetSafe Hub - Evcil Hayvan GÃ¼venliÄŸi ve BakÄ±mÄ±</title>{% endblock baslik %}

{% block css_dosyalar %}
<link href="https://unpkg.com/aos@next/dist/aos.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
<link href="{% static 'css/ev.css' %}" rel="stylesheet">
{% endblock css_dosyalar %}

    

{% block content %}
<!-- ğŸŒŸ Hero Section -->
<section class="hero-section">
    <div class="hero-slides-container">
        <!-- Slide 0: VarsayÄ±lan (Sabit Ä°Ã§erik) -->
        <div class="hero-slide active" data-slide="0">
            <div class="slide-background slide-background-desktop"
                style="background: linear-gradient(135deg, #5B9BD5 0%, #70C1B3 50%, #6FCF97 100%); animation: heroGradient 15s ease infinite; background-size: 200% 200%;">
            </div>
            <div class="slide-background slide-background-mobile"
                style="background: linear-gradient(135deg, #5B9BD5 0%, #70C1B3 50%, #6FCF97 100%); animation: heroGradient 15s ease infinite; background-size: 200% 200%;">
            </div>
            <div class="slide-content">
                <!-- Sol Kolon: Metin ve Butonlar -->
                <div class="slide-content-left">
                    <div class="hero-content-wrapper">
                        <h1 class="animate__animated animate__fadeInDown">PetSafe Hub'a HoÅŸ Geldiniz</h1>
                        <p class="animate__animated animate__fadeIn animate__delay-1s">Evcil hayvanlarÄ±nÄ±zÄ± yenilikÃ§i
                            kimlik Ã§Ã¶zÃ¼mleri ile koruyun</p>
                    </div>
                </div>
                <!-- SaÄŸ Kolon: Dekoratif Alan (PC'de gÃ¶rÃ¼nÃ¼r) -->
                <div class="slide-content-right">
                    <div class="hero-decorative-area">
                        <div class="hero-decorative-element"
                            style="font-size: 15rem; color: rgba(255,255,255,0.08); transform: rotate(-15deg); top: 10%; right: 10%;">
                            ğŸ¾
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- HeroSlide'lardan Gelen Dinamik Slide'lar -->
        {% for slide in hero_slides %}
        <div class="hero-slide" data-slide="{{ forloop.counter }}">
            <!-- MasaÃ¼stÃ¼ GÃ¶rsel - Lazy loading with data attributes -->
            <div class="slide-background slide-background-desktop" 
                {% if slide.arka_plan_resim %}
                data-bg-desktop="{{ slide.arka_plan_resim.url }}"
                style="{% if slide.arka_plan_renk %}background-color: {{ slide.arka_plan_renk }};{% else %}background: {{ slide.arka_plan_renk|default:'linear-gradient(135deg, #5B9BD5 0%, #70C1B3 100%)' }};{% endif %}"
                {% else %} 
                style="background: {{ slide.arka_plan_renk|default:'linear-gradient(135deg, #5B9BD5 0%, #70C1B3 100%)' }};" 
                {% endif %}>
                {% if slide.arka_plan_resim and slide.arka_plan_renk %}
                <div class="slide-background-overlay"
                    style="background: {{ slide.arka_plan_renk }}; mix-blend-mode: overlay;"></div>
                {% endif %}
            </div>
            <!-- Mobil GÃ¶rsel - Lazy loading with data attributes -->
            <div class="slide-background slide-background-mobile" 
                {% if slide.arka_plan_resim_mobil %}
                data-bg-mobile="{{ slide.arka_plan_resim_mobil.url }}"
                style="{% if slide.arka_plan_renk %}background-color: {{ slide.arka_plan_renk }};{% else %}background: {{ slide.arka_plan_renk|default:'linear-gradient(135deg, #5B9BD5 0%, #70C1B3 100%)' }};{% endif %}"
                {% elif slide.arka_plan_resim %}
                data-bg-mobile="{{ slide.arka_plan_resim.url }}"
                style="{% if slide.arka_plan_renk %}background-color: {{ slide.arka_plan_renk }};{% else %}background: {{ slide.arka_plan_renk|default:'linear-gradient(135deg, #5B9BD5 0%, #70C1B3 100%)' }};{% endif %}"
                {% else %} 
                style="background: {{ slide.arka_plan_renk|default:'linear-gradient(135deg, #5B9BD5 0%, #70C1B3 100%)' }};" 
                {% endif %}>
                {% if slide.arka_plan_resim_mobil and slide.arka_plan_renk %}
                <div class="slide-background-overlay"
                    style="background: {{ slide.arka_plan_renk }}; mix-blend-mode: overlay;"></div>
                {% elif slide.arka_plan_resim and slide.arka_plan_renk %}
                <div class="slide-background-overlay"
                    style="background: {{ slide.arka_plan_renk }}; mix-blend-mode: overlay;"></div>
                {% endif %}
            </div>
            <div class="slide-content">
                <!-- Sol Kolon: Metin ve Butonlar -->
                <div class="slide-content-left">
                    <div class="hero-content-wrapper">
                        <h1>{{ slide.baslik }}</h1>
                        <p>{{ slide.aciklama }}</p>
                    </div>
                </div>
                <!-- SaÄŸ Kolon: Dekoratif Alan (PC'de gÃ¶rÃ¼nÃ¼r) -->
                <div class="slide-content-right">
                    <div class="hero-decorative-area">
                        <div class="hero-decorative-element"
                            style="font-size: 15rem; color: rgba(255,255,255,0.08); transform: rotate(-15deg); top: 10%; right: 10%;">
                            ğŸ¾
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</section>

<!-- Statistics Section -->
<section class="stats-section">
    <div class="container">
        <!-- Hero Action Buttons - Sol Ã¼st (Desktop), OrtalÄ± (Mobil) -->
        <div class="hero-action-buttons">
            <a href="{% url 'etiket:lookup' %}" class="hero-action-btn">
                <i class="fas fa-search"></i>
                <span>Hayvan Bulundu</span>
            </a>
            {% if user.is_authenticated %}
            {% if user.sahip %}
            <a href="{% url 'anahtarlik:add_pet' %}" class="hero-action-btn">
                <i class="fas fa-tag"></i>
                <span>Etiket Aktive Et</span>
            </a>
            {% elif user.misafir_profili %}
            <a href="{% url 'guest_activate_tag' %}" class="hero-action-btn">
                <i class="fas fa-tag"></i>
                <span>Etiket Aktive Et</span>
            </a>
            {% endif %}
            {% else %}
            <a href="{% url 'kÃ¼nye_aktivasyon' %}" class="hero-action-btn">
                <i class="fas fa-tag"></i>
                <span>Etiket Aktive Et</span>
            </a>
            {% endif %}
        </div>

        <div class="row g-4">
            <div class="col-6 col-md-3">
                <div class="stat-card">
                    <div class="stat-number">{{ toplam_evcil_hayvan|default:"0" }}</div>
                    <div class="stat-label">KayÄ±tlÄ± Evcil Hayvan</div>
                </div>
            </div>
            <div class="col-6 col-md-3">
                <div class="stat-card">
                    <div class="stat-number">{{ toplam_urun|default:"0" }}</div>
                    <div class="stat-label">ÃœrÃ¼n Ã‡eÅŸidi</div>
                </div>
            </div>
            <div class="col-6 col-md-3">
                <div class="stat-card">
                    <div class="stat-number">{{ toplam_ilan|default:"0" }}</div>
                    <div class="stat-label">Aktif Ä°lan</div>
                </div>
            </div>
            <div class="col-6 col-md-3">
                <div class="stat-card">
                    <div class="stat-number">7/24</div>
                    <div class="stat-label">Destek Hizmeti</div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Services Section -->
<section id="hizmetler" class="services-section">
    <div class="container">
        <div class="section-title">
            <h2>{{ ayarlar.hizmetler_baslik|default:"Hizmetlerimiz" }}</h2>
            <p>{{ ayarlar.hizmetler_aciklama|default:"Evcil dostlarÄ±nÄ±z iÃ§in en iyi dijital kimlik ve saÄŸlÄ±k takip Ã§Ã¶zÃ¼mleri" }}</p>
        </div>

        {% if hizmet_kartlari %}
        <div class="row g-4">
            {% for kart in hizmet_kartlari %}
            <div class="col-12 col-md-6 col-lg-4" data-aos="fade-up" data-aos-delay="{{ kart.animasyon_gecikmesi }}">
                <div class="service-card">
                    <div class="service-icon">
                        <i class="{{ kart.ikon }}"></i>
                    </div>
                    <h4>{{ kart.baslik }}</h4>
                    <p>{{ kart.aciklama }}</p>
                    {% if "qr" in kart.baslik|lower or "qrcode" in kart.ikon|lower or "etiket" in kart.baslik|lower %}
                    <a href="{% url 'anahtarlik:qr_kunye_nasil_calisir' %}" class="service-btn">
                        <i class="fas fa-info-circle me-2"></i>NasÄ±l Ã‡alÄ±ÅŸÄ±r?
                    </a>
                    {% elif kart.buton_url %}
                    <a href="{{ kart.buton_url }}" class="service-btn">
                        {{ kart.buton_metin|default:"KeÅŸfet" }}
                    </a>
                    {% endif %}
                </div>
            </div>
            {% endfor %}

            <!-- Ä°lan ve Sahiplendirme KartÄ± -->
            <div class="col-12 col-md-6 col-lg-4" data-aos="fade-up" data-aos-delay="400">
                <div class="service-card">
                    <div class="service-icon"><i class="fas fa-heart"></i></div>
                    <h4>Ä°lan ve Sahiplendirme</h4>
                    <p>Yeni bir aile Ã¼yesi arÄ±yorsanÄ±z veya sevimli dostlarÄ±nÄ±z iÃ§in yuva arÄ±yorsanÄ±z ilanlarÄ±mÄ±zÄ±
                        inceleyin.</p>
                    <a href="{% url 'ilan:ilan_listesi' %}" class="service-btn">Ä°lanlarÄ± GÃ¶r</a>
                </div>
            </div>
        </div>
        {% else %}
        <!-- Fallback Services -->
        <div class="row g-4">
            <div class="col-12 col-md-6 col-lg-4">
                <div class="service-card">
                    <div class="service-icon"><i class="fas fa-qrcode"></i></div>
                    <h4>QR KÃ¼nye Sistemi</h4>
                    <p>KayÄ±p evcil hayvanÄ±nÄ±zÄ± bulmak iÃ§in teknolojik Ã§Ã¶zÃ¼m.</p>
                    <a href="{% url 'anahtarlik:qr_kunye_nasil_calisir' %}" class="service-btn">NasÄ±l Ã‡alÄ±ÅŸÄ±r?</a>
                </div>
            </div>
            <div class="col-12 col-md-6 col-lg-4">
                <div class="service-card">
                    <div class="service-icon"><i class="fas fa-calendar-check"></i></div>
                    <h4>Veteriner Randevu</h4>
                    <p>Online randevu sistemi ile veteriner bulun.</p>
                    <a href="{% url 'veteriner:veteriner_paneli' %}" class="service-btn">Randevu Al</a>
                </div>
            </div>
            <div class="col-12 col-md-6 col-lg-4">
                <div class="service-card">
                    <div class="service-icon"><i class="fas fa-shopping-cart"></i></div>
                    <h4>Pet MaÄŸaza</h4>
                    <p>Evcil hayvanlarÄ±nÄ±z iÃ§in kaliteli Ã¼rÃ¼nler.</p>
                    <a href="{% url 'shop:shop_home' %}" class="service-btn">AlÄ±ÅŸveriÅŸ Yap</a>
                </div>
            </div>
            <!-- Ä°lan ve Sahiplendirme KartÄ± -->
            <div class="col-12 col-md-6 col-lg-4">
                <div class="service-card">
                    <div class="service-icon"><i class="fas fa-heart"></i></div>
                    <h4>Ä°lan ve Sahiplendirme</h4>
                    <p>Yeni bir aile Ã¼yesi arÄ±yorsanÄ±z veya sevimli dostlarÄ±nÄ±z iÃ§in yuva arÄ±yorsanÄ±z ilanlarÄ±mÄ±zÄ±
                        inceleyin.</p>
                    <a href="{% url 'ilan:ilan_listesi' %}" class="service-btn">Ä°lanlarÄ± GÃ¶r</a>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</section>

<!-- QR KÃ¼nye NasÄ±l Ã‡alÄ±ÅŸÄ±r Section -->
<section id="how-qr-works-section" class="how-qr-works-section">
    <div class="container">
        <div class="section-title">
            <h2>QR KÃ¼nye NasÄ±l Ã‡alÄ±ÅŸÄ±r?</h2>
            <p>Evcil hayvanÄ±nÄ±zÄ±n gÃ¼venliÄŸi iÃ§in teknolojik Ã§Ã¶zÃ¼m</p>
        </div>

        <div class="row g-4 align-items-center mb-5">
            <div class="col-lg-6" data-aos="fade-right">
                <div class="qr-info-card">
                    <div class="qr-info-icon">
                        <i class="fas fa-qrcode"></i>
                    </div>
                    <h3>QR KÃ¼nye Nedir?</h3>
                    <p>QR kÃ¼nye, evcil hayvanÄ±nÄ±zÄ±n boynuna takÄ±lan Ã¶zel bir kimlik etiketidir. Ãœzerinde bulunan QR kod,
                        akÄ±llÄ± telefonla okutulduÄŸunda hayvanÄ±nÄ±zÄ±n profil bilgilerine ve sahibine hÄ±zlÄ±ca ulaÅŸÄ±lmasÄ±nÄ±
                        saÄŸlar.</p>
                    <div class="qr-benefits">
                        <div class="benefit-item">
                            <i class="fas fa-check-circle"></i>
                            <span>7/24 EriÅŸilebilir Bilgiler</span>
                        </div>
                        <div class="benefit-item">
                            <i class="fas fa-check-circle"></i>
                            <span>AnÄ±nda Ä°letiÅŸim</span>
                        </div>
                        <div class="benefit-item">
                            <i class="fas fa-check-circle"></i>
                            <span>GÃ¼venli ve HÄ±zlÄ±</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-6" data-aos="fade-left">
                <div class="qr-steps">
                    <div class="step-item">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h4>KÃ¼nyeyi SatÄ±n Al</h4>
                            <p>Size uygun QR kÃ¼nye Ã¼rÃ¼nÃ¼nÃ¼ seÃ§in ve satÄ±n alÄ±n.</p>
                        </div>
                    </div>
                    <div class="step-item">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h4>HesabÄ±nÄ±za AktifleÅŸtirin</h4>
                            <p>KÃ¼nyeyi hesabÄ±nÄ±za kaydedin ve evcil hayvanÄ±nÄ±zÄ±n bilgilerini ekleyin.</p>
                        </div>
                    </div>
                    <div class="step-item">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h4>HayvanÄ±nÄ±za TakÄ±n</h4>
                            <p>KÃ¼nyeyi hayvanÄ±nÄ±zÄ±n boynuna takÄ±n ve gÃ¼venliÄŸini saÄŸlayÄ±n.</p>
                        </div>
                    </div>
                    <div class="step-item">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <h4>Kaybolursa Hemen Bulunur</h4>
                            <p>Birisi QR kodu okuttuÄŸunda size anÄ±nda bildirim gelir ve hayvanÄ±nÄ±z bulunur.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="text-center mt-5" data-aos="fade-up">
            <a href="{% url 'anahtarlik:qr_kunye_nasil_calisir' %}" class="cta-btn">
                <i class="fas fa-info-circle me-2"></i>DetaylÄ± Bilgi Al
            </a>
        </div>
    </div>
</section>

<!-- Featured Products Section - TÃ¼m Etiket ÃœrÃ¼nleri (Horizontal Scroll) -->
{% if one_cikan_etiketler %}
<section class="featured-section">
    <div class="container">
        <div class="section-title">
            <h2>QR KÃ¼nyeler</h2>
            <p>Evcil hayvanÄ±nÄ±zÄ±n gÃ¼venliÄŸi iÃ§in tÃ¼m QR kÃ¼nye Ã¼rÃ¼nlerimiz</p>
        </div>

        <!-- Horizontal Scroll Container -->
        <div class="products-scroll-container">
            <div class="products-scroll-wrapper">
                {% for urun in one_cikan_etiketler %}
                <div class="product-card" data-aos="fade-up" data-aos-delay="{{ forloop.counter0|add:1 }}00">
                    {% if urun.etiket_kategori and urun.etiket_kategori.ilk_fotograf %}
                    <img src="{{ urun.etiket_kategori.ilk_fotograf.fotograf.url }}" alt="{{ urun.ad }}"
                        class="product-image" loading="lazy" decoding="async" width="280" height="220">
                    {% elif urun.resimler.first %}
                    <img src="{{ urun.resimler.first.resim.url }}" alt="{{ urun.ad }}" class="product-image" loading="lazy" decoding="async" width="280" height="220">
                    {% else %}
                    <div class="product-image"
                        style="display: flex; align-items: center; justify-content: center; background: var(--primary-gradient); color: white;">
                        <i class="fas fa-qrcode fa-3x"></i>
                    </div>
                    {% endif %}
                    <div class="product-body">
                        <h5 class="product-title">{{ urun.ad|truncatewords:6 }}</h5>
                        <div class="product-price">â‚º{{ urun.kullanici_fiyati|floatformat:2 }}</div>
                        <a href="{% url 'shop:urun_detay' urun.id %}" class="product-btn">Ä°ncele</a>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <div class="text-center mt-5" data-aos="fade-up" data-aos-delay="400">
            <a href="{% url 'shop:etiket_list' %}" class="cta-btn">
                <i class="fas fa-tag me-2"></i>TÃ¼m KÃ¼nyeleri GÃ¶r
            </a>
        </div>
    </div>
</section>
{% endif %}



<!-- CTA Section -->
<section class="cta-section">
    <div class="container">
        <h2 class="cta-title">Evcil HayvanÄ±nÄ±zÄ± Åimdi Koruyun!</h2>
        <p class="cta-description">YenilikÃ§i QR etiketlerimiz ve mikroÃ§ip hizmetlerimizle evcil hayvanÄ±nÄ±zÄ±n gÃ¼venliÄŸini
            garantileyin.</p>
        <a href="{% url 'shop:shop_home' %}" class="cta-btn">
            <i class="fas fa-shopping-cart me-2"></i>Hemen SatÄ±n Al
        </a>
    </div>
</section>

<!-- Back to Top Button -->
<a href="#" class="back-to-top">
    <i class="fas fa-arrow-up"></i>
</a>

{% endblock %}

{% block js_dosyalar %}
<script>
    // Hero Section Slide System with Lazy Loading
    (function () {
        const slides = document.querySelectorAll('.hero-slide');
        if (slides.length <= 1) return; // Tek slide varsa geÃ§iÅŸ yok

        // Lazy load background images using Intersection Observer
        const lazyLoadObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const slide = entry.target;
                    const desktopBg = slide.querySelector('.slide-background-desktop');
                    const mobileBg = slide.querySelector('.slide-background-mobile');
                    
                    // Load desktop background
                    if (desktopBg && desktopBg.dataset.bgDesktop) {
                        desktopBg.style.backgroundImage = `url('${desktopBg.dataset.bgDesktop}')`;
                        desktopBg.removeAttribute('data-bg-desktop');
                    }
                    
                    // Load mobile background
                    if (mobileBg && mobileBg.dataset.bgMobile) {
                        mobileBg.style.backgroundImage = `url('${mobileBg.dataset.bgMobile}')`;
                        mobileBg.removeAttribute('data-bg-mobile');
                    }
                    
                    lazyLoadObserver.unobserve(slide);
                }
            });
        }, { rootMargin: '50px' });

        // Observe all slides for lazy loading
        slides.forEach(slide => lazyLoadObserver.observe(slide));

        let currentSlide = 0;
        const slideInterval = {% if ayarlar and ayarlar.slide_gecis_suresi %}{{ ayarlar.slide_gecis_suresi }}{% else %}5000{% endif %};

        function showSlide(index) {
            // TÃ¼m slide'larÄ± pasif yap
            slides.forEach((slide, i) => {
                slide.classList.remove('active');
            });

            // Aktif slide'Ä± gÃ¶ster
            if (slides[index]) {
                slides[index].classList.add('active');
                
                // Preload next slide background
                const nextIndex = (index + 1) % slides.length;
                if (slides[nextIndex]) {
                    const nextDesktopBg = slides[nextIndex].querySelector('.slide-background-desktop');
                    const nextMobileBg = slides[nextIndex].querySelector('.slide-background-mobile');
                    
                    if (nextDesktopBg && nextDesktopBg.dataset.bgDesktop) {
                        const img = new Image();
                        img.src = nextDesktopBg.dataset.bgDesktop;
                    }
                    
                    if (nextMobileBg && nextMobileBg.dataset.bgMobile) {
                        const img = new Image();
                        img.src = nextMobileBg.dataset.bgMobile;
                    }
                }
            }
        }

        function nextSlide() {
            currentSlide = (currentSlide + 1) % slides.length;
            showSlide(currentSlide);
        }

        // Ä°lk slide'Ä± gÃ¶ster (index 0 zaten active class'Ä± ile baÅŸlÄ±yor)
        // Load first slide immediately
        showSlide(0);
        
        // Otomatik geÃ§iÅŸi baÅŸlat (only if user prefers motion)
        if (slides.length > 1 && !window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
            setInterval(nextSlide, slideInterval);
        }
    })();

    // Back to top button
    const backToTopButton = document.querySelector('.back-to-top');

    window.addEventListener('scroll', function () {
        if (window.pageYOffset > 300) {
            backToTopButton.classList.add('show');
        } else {
            backToTopButton.classList.remove('show');
        }
    });

    backToTopButton.addEventListener('click', function (e) {
        e.preventDefault();
        window.scrollTo({
            top: 0,
            behavior: 'smooth'
        });
    });

    // Smooth scrolling for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            const href = this.getAttribute('href');
            if (href === '#') return;

            const targetElement = document.querySelector(href);
            if (targetElement) {
                e.preventDefault();
                const headerOffset = 100;
                const elementPosition = targetElement.getBoundingClientRect().top;
                const offsetPosition = elementPosition + window.pageYOffset - headerOffset;

                window.scrollTo({
                    top: offsetPosition,
                    behavior: 'smooth'
                });
            }
        });
    });

    // Initialize AOS animations with performance optimizations
    if (typeof AOS !== 'undefined') {
        // Disable AOS on mobile for better performance
        const isMobile = window.innerWidth < 768;
        const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
        
        if (!isMobile && !prefersReducedMotion) {
            AOS.init({
                duration: 800,
                once: true,
                easing: 'ease-out-cubic',
                offset: 50,
                disable: isMobile || prefersReducedMotion
            });
        }
    }
    
    // Lazy load images that are not yet visible
    if ('IntersectionObserver' in window) {
        const imageObserver = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const img = entry.target;
                    if (img.dataset.src) {
                        img.src = img.dataset.src;
                        img.removeAttribute('data-src');
                    }
                    observer.unobserve(img);
                }
            });
        }, { rootMargin: '50px' });

        document.querySelectorAll('img[data-src]').forEach(img => imageObserver.observe(img));
    }
</script>
{% endblock js_dosyalar %}