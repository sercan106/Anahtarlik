<!-- templates/ana.html -->
{% load static %}
<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
    <meta name="description" content="PetSafe Hub - Evcil hayvanlarınız için QR künye sistemi, veteriner randevu ve pet shop hizmetleri">
    <meta name="theme-color" content="#5B9BD5">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <!-- Preconnect for performance -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
    <link rel="dns-prefetch" href="https://unpkg.com">
    
    <title>{% block baslik %}PetSafe Hub{% endblock %}</title>
    
    <!-- Critical CSS - Bootstrap (minified) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" media="print" onload="this.media='all'">
    <noscript><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"></noscript>
    
    <!-- Font Awesome (deferred) -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet" media="print" onload="this.media='all'">
    <noscript><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet"></noscript>
    
    <!-- AOS Animation (deferred) -->
    <link href="https://unpkg.com/aos@next/dist/aos.css" rel="stylesheet" media="print" onload="this.media='all'">
    <noscript><link href="https://unpkg.com/aos@next/dist/aos.css" rel="stylesheet"></noscript>
    
    <!-- Animate.css (deferred) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" media="print" onload="this.media='all'">
    <noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"></noscript>
    
    <!-- Google Fonts (preload + swap) -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet"></noscript>
    
    <!-- Base CSS -->
    <link href="{% static 'css/base.css' %}" rel="stylesheet">
    {% block css_dosyalar %}{% endblock %}
</head>

<body data-districts-endpoint="{% url 'districts_for_province' %}">
    <!-- 🔄 Page Loader -->
    <div class="page-loader" id="pageLoader">
        <div class="loader-content">
            <div class="loader-paw">🐾</div>
            <div class="loader-text">
                Yükleniyor
                <span class="loader-dots">
                    <span></span>
                    <span></span>
                    <span></span>
                </span>
            </div>
        </div>
    </div>

    <nav class="ust-menu navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="ust-menu-marka navbar-brand d-flex align-items-center" href="{% url 'anahtarlik:ev' %}">
                <i class="fas fa-paw"></i> <span class="ms-1 ms-md-2">PetSafe Hub</span>
            </a>

            <!-- Mobile Right Actions - Optimized Order & Spacing -->
            <div class="d-flex d-lg-none align-items-center order-lg-2 mobile-navbar-actions">
                {% if user.is_authenticated %}
                    <!-- 1. Profil Button (En solda - Kullanıcı bilgisi) -->
                {% if user.misafir_profili or user.sahip or user.veteriner_profili or user.petshop_profili %}
                    <button class="mobile-profil-btn" type="button"
                        data-bs-toggle="offcanvas" data-bs-target="#mobileProfilOffcanvas" aria-expanded="false" title="Profilim">
                        <div class="profil-avatar">
                            {% if user.misafir_profili %}
                            <i class="fas fa-user-astronaut text-white"></i>
                            {% elif user.sahip and user.sahip.profil_fotografi %}
                            <img src="{{ user.sahip.profil_fotografi.url }}" alt="Profil"
                                style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">
                            {% elif user.sahip %}
                            <i class="fas fa-user text-white"></i>
                            {% elif user.veteriner_profili %}
                            <i class="fas fa-user-md text-white"></i>
                            {% elif user.petshop_profili %}
                            <i class="fas fa-store text-white"></i>
                            {% endif %}
                        </div>
                    </button>
                    {% endif %}

                    <!-- 2. Bildirim Button (Sadece Sahip için) -->
                    {% if user.sahip %}
                    <a href="{% url 'anahtarlik:bildirimler' %}" class="mobile-action-btn mobile-notification-btn"
                        title="Bildirimler">
                        <i class="fas fa-bell"></i>
                        {% if okunmamis_bildirim_sayisi > 0 %}
                        <span class="badge">{{ okunmamis_bildirim_sayisi }}</span>
                        {% endif %}
                    </a>
                    {% endif %}
                {% endif %}

                <!-- 3. Sepet Button (Her zaman görünür) -->
                <a href="{% url 'shop:sepet_goster' %}" class="mobile-action-btn sepet-btn" data-bs-toggle="offcanvas"
                    data-bs-target="#sepetYanMenu" title="Sepetim">
                    <i class="fas fa-shopping-cart"></i>
                    {% if sepet_adet > 0 %}
                    <span class="badge">{{ sepet_adet }}</span>
                    {% endif %}
                </a>

                <!-- 4. Hamburger Menu Button (En sağda - Menü) -->
                <button class="hamburger-btn navbar-toggler" type="button" data-bs-toggle="offcanvas"
                    data-bs-target="#mobileMenuOffcanvas" aria-expanded="false" aria-label="Menüyü Aç" title="Menü">
                    <span class="navbar-toggler-icon"></span>
                </button>
            </div>

            <!-- Desktop Navbar Collapse - Only Navigation Links -->
            <div class="collapse navbar-collapse ust-menu-kapsayici order-lg-1 d-none d-lg-block" id="ustMenuNav">
                <ul class="ust-menu-nav navbar-nav ms-auto me-auto">
                    <li class="nav-item"><a class="ust-menu-baglantisi nav-link" href="{% url 'anahtarlik:ev' %}">Ana
                            Sayfa</a></li>
                    <li class="nav-item"><a class="ust-menu-baglantisi nav-link"
                            href="{% url 'anahtarlik:qr_kunye_nasil_calisir' %}">Nasıl Çalışır?</a></li>
                    <li class="nav-item"><a class="ust-menu-baglantisi nav-link"
                            href="{% url 'shop:shop_home' %}">Mağaza</a></li>
                    <li class="nav-item"><a class="ust-menu-baglantisi nav-link"
                            href="{% url 'ilan:ilan_listesi' %}">İlanlar</a></li>
                </ul>

                <!-- Desktop Auth Actions (Bildirim & Profile) -->
                <div class="d-none d-lg-flex align-items-center ms-auto gap-2">
                    {% if user.is_authenticated %}
                    <!-- Bildirim Butonu (Sadece Sahip Kullanıcılar İçin) -->
                    {% if user.sahip %}
                    <a href="{% url 'anahtarlik:bildirimler' %}" class="desktop-action-btn desktop-notification-btn"
                        title="Bildirimler">
                        <i class="fas fa-bell"></i>
                        {% if okunmamis_bildirim_sayisi > 0 %}
                        <span class="badge">{{ okunmamis_bildirim_sayisi }}</span>
                        {% endif %}
                    </a>
                    {% endif %}

                    <!-- Desktop Profil Dropdown -->
                    {% if user.misafir_profili or user.sahip or user.veteriner_profili or user.petshop_profili %}
                    <div class="dropdown desktop-profil-dropdown">
                        <button class="desktop-action-btn desktop-profile-btn dropdown-toggle" type="button"
                            data-bs-toggle="dropdown" aria-expanded="false">
                            <div class="profil-avatar">
                                {% if user.misafir_profili %}
                                <i class="fas fa-user-astronaut text-white"></i>
                                {% elif user.sahip and user.sahip.profil_fotografi %}
                                <img src="{{ user.sahip.profil_fotografi.url }}" alt="Profil">
                                {% elif user.sahip %}
                                <i class="fas fa-user text-white"></i>
                                {% elif user.veteriner_profili and user.veteriner_profili.logo %}
                                <img src="{{ user.veteriner_profili.logo.url }}" alt="Profil">
                                {% elif user.veteriner_profili %}
                                <i class="fas fa-user-md text-white"></i>
                                {% elif user.petshop_profili and user.petshop_profili.logo %}
                                <img src="{{ user.petshop_profili.logo.url }}" alt="Profil">
                                {% elif user.petshop_profili %}
                                <i class="fas fa-store text-white"></i>
                                {% endif %}
                            </div>
                            <span class="profil-username">
                            {% if user.sahip %}
                            {% if user.sahip.ad %}
                            {{ user.sahip.ad }}
                            {% endif %}
                            {% else %}
                            {{ user.first_name|default:user.username }}
                            {% endif %}
                        </span>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end">
                        {% if user.misafir_profili %}
                        <!-- MİSAFİR KULLANICI - MODERN DROPDOWN -->
                        <li class="profile-card">
                            <div class="profile-card-avatar">
                                <i class="fas fa-user-astronaut text-white"></i>
                            </div>
                            <div class="profile-card-name">{{ user.first_name|default:user.username }}</div>
                            <div class="profile-card-role">
                                <span class="badge role-badge-misafir">Misafir Üye</span>
                            </div>
                        </li>

                        <li class="quick-stats">
                            <div class="quick-stat-item">
                                <span class="quick-stat-value">{{ user_kredi_bakiye|default:0 }}</span>
                                <span class="quick-stat-label">Kredi</span>
                            </div>
                            <div class="quick-stat-item">
                                <span class="quick-stat-value">{{ sahip_ilan_sayisi|default:0 }}</span>
                                <span class="quick-stat-label">İlan</span>
                            </div>
                        </li>

                        <li class="menu-group">
                            <div class="menu-group-title">Ana İşlemler</div>
                            <a class="dropdown-item" href="{% url 'guest_dashboard' %}">
                                <i class="fas fa-user-circle"></i>
                                <span>Profilim</span>
                            </a>
                            {% if sahip_ilan_sayisi > 0 %}
                            <a class="dropdown-item" href="{% url 'ilan:kullanici_ilanlari' %}">
                                <i class="fas fa-clipboard-list"></i>
                                <span>İlanlarım</span>
                                <span class="badge bg-primary">{{ sahip_ilan_sayisi }}</span>
                            </a>
                            {% endif %}
                            <a class="dropdown-item" href="{% url 'ilan:kredi_durumu' %}">
                                <i class="fas fa-coins"></i>
                                <span>Kredi İşlemlerim</span>
                            </a>
                        </li>

                        <li>
                            <hr class="dropdown-divider">
                        </li>

                        <li class="menu-group">
                            <a class="dropdown-item text-danger" href="{% url 'user_logout' %}">
                                <i class="fas fa-sign-out-alt"></i>
                                <span>Çıkış Yap</span>
                            </a>
                        </li>
                        {% elif user.sahip %}
                        <!-- SAHİP KULLANICI - MODERN DROPDOWN -->
                        <li class="profile-card">
                            <div class="profile-card-avatar">
                                {% if user.sahip.profil_fotografi %}
                                <img src="{{ user.sahip.profil_fotografi.url }}" alt="Profil">
                                {% else %}
                                <i class="fas fa-user text-white"></i>
                                {% endif %}
                            </div>
                            <div class="profile-card-name">
                                    {% if user.sahip.ad and user.sahip.soyad %}
                                    {{ user.sahip.ad }} {{ user.sahip.soyad }}
                                    {% elif user.sahip.ad %}
                                {{ user.sahip.ad }}
                                {% endif %}
                            </div>
                            <div class="profile-card-role">
                                <span class="badge role-badge-sahip">Evcil Hayvan Sahibi</span>
                                {% if user.sahip.pro_aktif_mi %}
                                <span class="pro-badge"><i class="fas fa-crown"></i> PRO</span>
                                {% endif %}
                            </div>
                            <div class="quick-stat-item">
                                <span class="quick-stat-value">{{ sahip_kunye_sayisi|default:0 }}</span>
                                <span class="quick-stat-label">Künye</span>
                            </div>
                        </li>

                        <li class="menu-group">
                            <div class="menu-group-title">Ana İşlemler</div>
                            <a class="dropdown-item" href="{% url 'anahtarlik:kullanici_paneli' %}">
                                <i class="fas fa-home"></i>
                                <span>Panelim</span>
                            </a>
                            <a class="dropdown-item" href="{% url 'anahtarlik:sahip_profilim' %}">
                                <i class="fas fa-user-circle"></i>
                                <span>Profilim</span>
                            </a>
                            <a class="dropdown-item" href="{% url 'anahtarlik:evcil_hayvanlarim' %}">
                                <i class="fas fa-paw"></i>
                                <span>Evcil Hayvanlarım</span>
                            </a>
                            <a class="dropdown-item" href="{% url 'anahtarlik:kunyelerim' %}">
                                <i class="fas fa-qrcode"></i>
                                <span>Künyelerim</span>
                            </a>
                            {% if sahip_ilan_sayisi > 0 %}
                            <a class="dropdown-item" href="{% url 'ilan:kullanici_ilanlari' %}">
                                <i class="fas fa-clipboard-list"></i>
                                <span>İlanlarım</span>
                                <span class="badge bg-primary">{{ sahip_ilan_sayisi }}</span>
                            </a>
                            {% endif %}
                            <a class="dropdown-item" href="{% url 'shop:siparis_listesi' %}">
                                <i class="fas fa-box"></i>
                                <span>Siparişlerim</span>
                            </a>
                        </li>

                        <li>
                            <hr class="dropdown-divider">
                        </li>

                        <li class="menu-group">
                            <div class="menu-group-title">Diğer</div>
                            {% if user.sahip.pro_aktif_mi %}
                            <a class="dropdown-item" href="{% url 'anahtarlik:sahip_pro_panel' %}">
                                <i class="fas fa-star text-warning"></i>
                                <span>Pro Panel</span>
                            </a>
                            {% else %}
                            <a class="dropdown-item" href="{% url 'anahtarlik:sahip_pro_paketler' %}">
                                <i class="fas fa-crown"></i>
                                <span>Pro'ya Geç</span>
                            </a>
                            {% endif %}
                            <a class="dropdown-item text-danger" href="{% url 'user_logout' %}">
                                <i class="fas fa-sign-out-alt"></i>
                                <span>Çıkış Yap</span>
                            </a>
                        </li>
                        {% elif user.veteriner_profili %}
                        <!-- VETERİNER KULLANICI - MODERN DROPDOWN -->
                        <li class="profile-card">
                            <div class="profile-card-avatar">
                                {% if user.veteriner_profili.logo %}
                                <img src="{{ user.veteriner_profili.logo.url }}" alt="Profil">
                                {% else %}
                                <i class="fas fa-user-md text-white"></i>
                                {% endif %}
                            </div>
                                <div class="profile-card-name">{{
                                    user.veteriner_profili.klinik_adi|default:user.username }}</div>
                            <div class="profile-card-role">
                                <span class="badge role-badge-veteriner">Veteriner</span>
                                {% if user.veteriner_profili.web_aktif %}
                                <span class="badge bg-success"><i class="fas fa-globe"></i> Web Aktif</span>
                                {% endif %}
                            </div>
                        </li>

                        <li class="quick-stats">
                            <div class="quick-stat-item">
                                <span class="quick-stat-value">{{ user.veteriner_profili.randevular.count|default:0
                                    }}</span>
                                <span class="quick-stat-label">Randevu</span>
                            </div>
                            <div class="quick-stat-item">
                                <span class="quick-stat-value">{{ sahip_ilan_sayisi|default:0 }}</span>
                                <span class="quick-stat-label">İlan</span>
                            </div>
                            <div class="quick-stat-item">
                                <span class="quick-stat-value">{{
                                    user.veteriner_profili.ortalama_puan|floatformat:1|default:"5.0" }}</span>
                                <span class="quick-stat-label">Puan</span>
                            </div>
                        </li>

                        <li class="menu-group">
                            <div class="menu-group-title">Ana İşlemler</div>
                            <a class="dropdown-item" href="{% url 'veteriner:veteriner_paneli' %}">
                                <i class="fas fa-home"></i>
                                <span>Panelim</span>
                            </a>
                            <a class="dropdown-item" href="{% url 'veteriner:veteriner_profilim' %}">
                                <i class="fas fa-user-circle"></i>
                                <span>Profilim</span>
                            </a>
                            <a class="dropdown-item" href="{% url 'veteriner:randevu_yonetimi' %}">
                                <i class="fas fa-calendar"></i>
                                <span>Randevular</span>
                            </a>
                            {% if sahip_ilan_sayisi > 0 %}
                            <a class="dropdown-item" href="{% url 'ilan:kullanici_ilanlari' %}">
                                <i class="fas fa-bullhorn"></i>
                                <span>İlanlarım</span>
                                <span class="badge bg-primary">{{ sahip_ilan_sayisi }}</span>
                            </a>
                            {% endif %}
                            <a class="dropdown-item" href="{% url 'shop:siparis_listesi' %}">
                                <i class="fas fa-box"></i>
                                <span>Siparişlerim</span>
                            </a>
                        </li>

                        <li>
                            <hr class="dropdown-divider">
                        </li>

                        <li class="menu-group">
                            <div class="menu-group-title">Web Sayfası</div>
                            <a class="dropdown-item" href="{% url 'veteriner:web_sayfasi_duzenle' %}">
                                <i class="fas fa-globe"></i>
                                <span>Web Sayfamı Düzenle</span>
                            </a>
                            {% if user.veteriner_profili.web_aktif and user.veteriner_profili.web_slug %}
                            <a class="dropdown-item"
                                href="{% url 'veteriner:web_sayfasi_gorunum' user.veteriner_profili.web_slug %}"
                                target="_blank">
                                <i class="fas fa-external-link-alt"></i>
                                <span>Sayfamı Görüntüle</span>
                            </a>
                            {% endif %}
                        </li>

                        <li>
                            <hr class="dropdown-divider">
                        </li>

                        <li class="menu-group">
                            <div class="menu-group-title">Diğer</div>
                            <a class="dropdown-item" href="{% url 'veteriner:hesap_ayarlari' %}">
                                <i class="fas fa-cog"></i>
                                <span>Hesap Ayarları</span>
                            </a>
                            <a class="dropdown-item text-danger" href="{% url 'user_logout' %}">
                                <i class="fas fa-sign-out-alt"></i>
                                <span>Çıkış Yap</span>
                            </a>
                        </li>
                        {% elif user.petshop_profili %}
                        <!-- PETSHOP KULLANICI - MODERN DROPDOWN -->
                        <li class="profile-card">
                            <div class="profile-card-avatar">
                                {% if user.petshop_profili.logo %}
                                <img src="{{ user.petshop_profili.logo.url }}" alt="Profil">
                                {% else %}
                                <i class="fas fa-store text-white"></i>
                                {% endif %}
                            </div>
                                <div class="profile-card-name">{{ user.petshop_profili.magaza_adi|default:user.username
                                    }}</div>
                            <div class="profile-card-role">
                                <span class="badge role-badge-petshop">Pet Shop</span>
                                {% if user.petshop_profili.web_aktif %}
                                <span class="badge bg-success"><i class="fas fa-globe"></i> Web Aktif</span>
                                {% endif %}
                            </div>
                        </li>

                        <li class="quick-stats">
                            <div class="quick-stat-item">
                                    <span class="quick-stat-value">{{ user.petshop_profili.urunler.count|default:0
                                        }}</span>
                                <span class="quick-stat-label">Ürün</span>
                            </div>
                            <div class="quick-stat-item">
                                <span class="quick-stat-value">{{ sahip_ilan_sayisi|default:0 }}</span>
                                <span class="quick-stat-label">İlan</span>
                            </div>
                            <div class="quick-stat-item">
                                <span class="quick-stat-value">{{
                                    user.petshop_profili.ortalama_puan|floatformat:1|default:"5.0" }}</span>
                                <span class="quick-stat-label">Puan</span>
                            </div>
                        </li>

                        <li class="menu-group">
                            <div class="menu-group-title">Ana İşlemler</div>
                            <a class="dropdown-item" href="{% url 'petshop:petshop_paneli' %}">
                                <i class="fas fa-home"></i>
                                <span>Panelim</span>
                            </a>
                            <a class="dropdown-item" href="{% url 'petshop:petshop_profilim' %}">
                                <i class="fas fa-user-circle"></i>
                                <span>Profilim</span>
                            </a>
                            {% if sahip_ilan_sayisi > 0 %}
                            <a class="dropdown-item" href="{% url 'ilan:kullanici_ilanlari' %}">
                                <i class="fas fa-bullhorn"></i>
                                <span>İlanlarım</span>
                                <span class="badge bg-primary">{{ sahip_ilan_sayisi }}</span>
                            </a>
                            {% endif %}
                            <a class="dropdown-item" href="{% url 'shop:siparis_listesi' %}">
                                <i class="fas fa-box"></i>
                                <span>Siparişlerim</span>
                            </a>
                        </li>

                        <li>
                            <hr class="dropdown-divider">
                        </li>

                        <li class="menu-group">
                            <div class="menu-group-title">Web Sayfası</div>
                            <a class="dropdown-item" href="{% url 'petshop:web_sayfasi_duzenle' %}">
                                <i class="fas fa-globe"></i>
                                <span>Web Sayfamı Düzenle</span>
                            </a>
                            {% if user.petshop_profili.web_aktif and user.petshop_profili.web_slug %}
                            <a class="dropdown-item"
                                href="{% url 'petshop:web_sayfasi_gorunum' user.petshop_profili.web_slug %}"
                                target="_blank">
                                <i class="fas fa-external-link-alt"></i>
                                <span>Sayfamı Görüntüle</span>
                            </a>
                            {% endif %}
                        </li>

                        <li>
                            <hr class="dropdown-divider">
                        </li>

                        <li class="menu-group">
                            <div class="menu-group-title">Diğer</div>
                            <a class="dropdown-item" href="{% url 'petshop:hesap_ayarlari' %}">
                                <i class="fas fa-cog"></i>
                                <span>Hesap Ayarları</span>
                            </a>
                            <a class="dropdown-item text-danger" href="{% url 'user_logout' %}">
                                <i class="fas fa-sign-out-alt"></i>
                                <span>Çıkış Yap</span>
                            </a>
                        </li>
                        {% endif %}
                    </ul>
                </div>
                {% endif %}

                    <!-- İlan Ver Button (Desktop) -->
                    {% if user.sahip %}
                    <a href="{% url 'ilan:sahip_ilan_verme_kontrol' %}" class="desktop-action-btn desktop-ilan-ver-btn">
                        <i class="fas fa-plus-circle"></i>
                        <span>İlan Ver</span>
                    </a>
                    {% else %}
                    <a href="{% url 'ilan:ilan_olustur' %}" class="desktop-action-btn desktop-ilan-ver-btn">
                        <i class="fas fa-plus-circle"></i>
                        <span>İlan Ver</span>
                </a>
                {% endif %}

                    <!-- Sepet Button (Desktop) -->
                    <a href="{% url 'shop:sepet_goster' %}" class="desktop-action-btn desktop-sepet-btn"
                        data-bs-toggle="offcanvas" data-bs-target="#sepetYanMenu" title="Sepetim">
                    <i class="fas fa-shopping-cart"></i>
                    {% if sepet_adet > 0 %}
                    <span class="badge">{{ sepet_adet }}</span>
                    {% endif %}
                </a>

                    {% else %}
                    <!-- Guest User Auth Buttons (Desktop only) -->
                    <a href="{% url 'user_login' %}" class="desktop-action-btn desktop-login-btn">
                        <i class="fas fa-sign-in-alt"></i>
                        <span>Giriş Yap</span>
                    </a>

                    <!-- İlan Ver Button (Guest) -->
                    <a href="{% url 'guest_register' %}" class="desktop-action-btn desktop-ilan-ver-btn">
                        <i class="fas fa-bullhorn"></i>
                        <span>İlan Ver</span>
                    </a>

                    <!-- Sepet Button (Guest) -->
                    <a href="{% url 'shop:sepet_goster' %}" class="desktop-action-btn desktop-sepet-btn"
                        data-bs-toggle="offcanvas" data-bs-target="#sepetYanMenu" title="Sepetim">
                        <i class="fas fa-shopping-cart"></i>
                        {% if sepet_adet > 0 %}
                        <span class="badge">{{ sepet_adet }}</span>
                        {% endif %}
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
    </nav>

    <!-- Mobile Profil Offcanvas - Tam Ekran -->
    <div class="offcanvas offcanvas-start mobile-profil-offcanvas d-lg-none" tabindex="-1" id="mobileProfilOffcanvas">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title mb-0 text-white d-flex align-items-center">
                <i class="fas fa-user-circle me-2"></i>Profilim
            </h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Kapat"></button>
        </div>
        <div class="offcanvas-body">
            {% if user.is_authenticated %}
                    {% if user.misafir_profili or user.sahip or user.veteriner_profili or user.petshop_profili %}
                                {% if user.misafir_profili %}
                    <!-- MİSAFİR KULLANICI -->
                    <div class="profile-card mb-4">
                                <div class="profile-card-avatar">
                                    <i class="fas fa-user-astronaut text-white"></i>
                                </div>
                                <div class="profile-card-name">{{ user.first_name|default:user.username }}</div>
                                <div class="profile-card-role">
                                    <span class="badge role-badge-misafir">Misafir Üye</span>
                                </div>
                    </div>

                    <div class="quick-stats mb-4">
                                <div class="quick-stat-item">
                                    <span class="quick-stat-value">{{ user_kredi_bakiye|default:0 }}</span>
                                    <span class="quick-stat-label">Kredi</span>
                                </div>
                                <div class="quick-stat-item">
                                    <span class="quick-stat-value">{{ sahip_ilan_sayisi|default:0 }}</span>
                                    <span class="quick-stat-label">İlan</span>
                                </div>
                    </div>

                    <div class="menu-group mb-3">
                                <div class="menu-group-title">Ana İşlemler</div>
                        <a class="nav-link" href="{% url 'guest_dashboard' %}">
                            <i class="fas fa-user-circle"></i>Profilim
                                </a>
                                {% if sahip_ilan_sayisi > 0 %}
                        <a class="nav-link" href="{% url 'ilan:kullanici_ilanlari' %}">
                            <i class="fas fa-clipboard-list"></i>İlanlarım
                            <span class="badge bg-primary ms-auto">{{ sahip_ilan_sayisi }}</span>
                                </a>
                                {% endif %}
                        <a class="nav-link" href="{% url 'ilan:kredi_durumu' %}">
                            <i class="fas fa-coins"></i>Kredi İşlemlerim
                        </a>
                    </div>

                    <hr class="my-3 border-white border-opacity-25">

                    <a class="nav-link text-danger" href="{% url 'user_logout' %}">
                        <i class="fas fa-sign-out-alt"></i>Çıkış Yap
                    </a>

                            {% elif user.sahip %}
                    <!-- SAHİP KULLANICI -->
                    <div class="profile-card mb-4">
                                <div class="profile-card-avatar">
                                    {% if user.sahip.profil_fotografi %}
                                    <img src="{{ user.sahip.profil_fotografi.url }}" alt="Profil">
                                    {% else %}
                                    <i class="fas fa-user text-white"></i>
                                    {% endif %}
                                </div>
                                <div class="profile-card-name">
                            {% if user.sahip.ad %}{{ user.sahip.ad }}{% endif %}
                                </div>
                                <div class="profile-card-role">
                                    <span class="badge role-badge-sahip">Evcil Hayvan Sahibi</span>
                                    {% if user.sahip.pro_aktif_mi %}
                                    <span class="pro-badge"><i class="fas fa-crown"></i> PRO</span>
                                    {% endif %}
                                </div>
                    </div>

                    <div class="quick-stats mb-4">
                        <div class="quick-stat-item">
                            <span class="quick-stat-value">{{ user.sahip.evcil_hayvanlar.count|default:0 }}</span>
                            <span class="quick-stat-label">Hayvan</span>
                        </div>
                        <div class="quick-stat-item">
                            <span class="quick-stat-value">{{ sahip_ilan_sayisi|default:0 }}</span>
                            <span class="quick-stat-label">İlan</span>
                                </div>
                                <div class="quick-stat-item">
                                    <span class="quick-stat-value">{{ sahip_kunye_sayisi|default:0 }}</span>
                                    <span class="quick-stat-label">Künye</span>
                                </div>
                    </div>

                    <div class="menu-group mb-3">
                                <div class="menu-group-title">Ana İşlemler</div>
                        <a class="nav-link" href="{% url 'anahtarlik:kullanici_paneli' %}">
                            <i class="fas fa-home"></i>Panelim
                                </a>
                        <a class="nav-link" href="{% url 'anahtarlik:sahip_profilim' %}">
                            <i class="fas fa-user-circle"></i>Profilim
                                </a>
                        <a class="nav-link" href="{% url 'anahtarlik:evcil_hayvanlarim' %}">
                            <i class="fas fa-paw"></i>Evcil Hayvanlarım
                                </a>
                        <a class="nav-link" href="{% url 'anahtarlik:kunyelerim' %}">
                            <i class="fas fa-qrcode"></i>Künyelerim
                                </a>
                                {% if sahip_ilan_sayisi > 0 %}
                        <a class="nav-link" href="{% url 'ilan:kullanici_ilanlari' %}">
                            <i class="fas fa-clipboard-list"></i>İlanlarım
                            <span class="badge bg-primary ms-auto">{{ sahip_ilan_sayisi }}</span>
                                </a>
                                {% endif %}
                        <a class="nav-link" href="{% url 'shop:siparis_listesi' %}">
                            <i class="fas fa-box"></i>Siparişlerim
                                </a>
                    </div>

                    <hr class="my-3 border-white border-opacity-25">

                    <div class="menu-group mb-3">
                                <div class="menu-group-title">Diğer</div>
                                {% if user.sahip.pro_aktif_mi %}
                        <a class="nav-link" href="{% url 'anahtarlik:sahip_pro_panel' %}">
                            <i class="fas fa-star text-warning"></i>Pro Panel
                                </a>
                                {% else %}
                        <a class="nav-link" href="{% url 'anahtarlik:sahip_pro_paketler' %}">
                            <i class="fas fa-crown"></i>Pro'ya Geç
                                </a>
                                {% endif %}
                        <a class="nav-link text-danger" href="{% url 'user_logout' %}">
                            <i class="fas fa-sign-out-alt"></i>Çıkış Yap
                                </a>
                    </div>

                            {% elif user.veteriner_profili %}
                    <!-- VETERİNER KULLANICI -->
                    <div class="profile-card mb-4">
                                <div class="profile-card-avatar">
                                    {% if user.veteriner_profili.logo %}
                                    <img src="{{ user.veteriner_profili.logo.url }}" alt="Profil">
                                    {% else %}
                                    <i class="fas fa-user-md text-white"></i>
                                    {% endif %}
                                </div>
                        <div class="profile-card-name">{{ user.veteriner_profili.klinik_adi|default:user.username }}</div>
                                <div class="profile-card-role">
                                    <span class="badge role-badge-veteriner">Veteriner</span>
                                    {% if user.veteriner_profili.web_aktif %}
                                    <span class="badge bg-success"><i class="fas fa-globe"></i> Web Aktif</span>
                                    {% endif %}
                                </div>
                    </div>

                    <div class="quick-stats mb-4">
                                <div class="quick-stat-item">
                            <span class="quick-stat-value">{{ user.veteriner_profili.randevular.count|default:0 }}</span>
                                    <span class="quick-stat-label">Randevu</span>
                                </div>
                                <div class="quick-stat-item">
                                    <span class="quick-stat-value">{{ sahip_ilan_sayisi|default:0 }}</span>
                                    <span class="quick-stat-label">İlan</span>
                                </div>
                                <div class="quick-stat-item">
                            <span class="quick-stat-value">{{ user.veteriner_profili.ortalama_puan|floatformat:1|default:"5.0" }}</span>
                                    <span class="quick-stat-label">Puan</span>
                                </div>
                    </div>

                    <div class="menu-group mb-3">
                                <div class="menu-group-title">Ana İşlemler</div>
                        <a class="nav-link" href="{% url 'veteriner:veteriner_paneli' %}">
                            <i class="fas fa-home"></i>Panelim
                                </a>
                        <a class="nav-link" href="{% url 'veteriner:veteriner_profilim' %}">
                            <i class="fas fa-user-circle"></i>Profilim
                                </a>
                        <a class="nav-link" href="{% url 'veteriner:randevu_yonetimi' %}">
                            <i class="fas fa-calendar"></i>Randevular
                                </a>
                                {% if sahip_ilan_sayisi > 0 %}
                        <a class="nav-link" href="{% url 'ilan:kullanici_ilanlari' %}">
                            <i class="fas fa-bullhorn"></i>İlanlarım
                            <span class="badge bg-primary ms-auto">{{ sahip_ilan_sayisi }}</span>
                                </a>
                                {% endif %}
                        <a class="nav-link" href="{% url 'shop:siparis_listesi' %}">
                            <i class="fas fa-box"></i>Siparişlerim
                                </a>
                    </div>

                    <hr class="my-3 border-white border-opacity-25">

                    <div class="menu-group mb-3">
                                <div class="menu-group-title">Web Sayfası</div>
                        <a class="nav-link" href="{% url 'veteriner:web_sayfasi_duzenle' %}">
                            <i class="fas fa-globe"></i>Web Sayfamı Düzenle
                                </a>
                                {% if user.veteriner_profili.web_aktif and user.veteriner_profili.web_slug %}
                        <a class="nav-link" href="{% url 'veteriner:web_sayfasi_gorunum' user.veteriner_profili.web_slug %}" target="_blank">
                            <i class="fas fa-external-link-alt"></i>Sayfamı Görüntüle
                                </a>
                                {% endif %}
                    </div>

                    <hr class="my-3 border-white border-opacity-25">

                    <div class="menu-group mb-3">
                                <div class="menu-group-title">Diğer</div>
                        <a class="nav-link" href="{% url 'veteriner:hesap_ayarlari' %}">
                            <i class="fas fa-cog"></i>Hesap Ayarları
                                </a>
                        <a class="nav-link text-danger" href="{% url 'user_logout' %}">
                            <i class="fas fa-sign-out-alt"></i>Çıkış Yap
                                </a>
                    </div>

                            {% elif user.petshop_profili %}
                    <!-- PETSHOP KULLANICI -->
                    <div class="profile-card mb-4">
                                <div class="profile-card-avatar">
                                    {% if user.petshop_profili.logo %}
                                    <img src="{{ user.petshop_profili.logo.url }}" alt="Profil">
                                    {% else %}
                                    <i class="fas fa-store text-white"></i>
                                    {% endif %}
                                </div>
                        <div class="profile-card-name">{{ user.petshop_profili.magaza_adi|default:user.username }}</div>
                                <div class="profile-card-role">
                                    <span class="badge role-badge-petshop">Pet Shop</span>
                                    {% if user.petshop_profili.web_aktif %}
                                    <span class="badge bg-success"><i class="fas fa-globe"></i> Web Aktif</span>
                                    {% endif %}
                                </div>
                    </div>

                    <div class="quick-stats mb-4">
                                <div class="quick-stat-item">
                            <span class="quick-stat-value">{{ user.petshop_profili.urunler.count|default:0 }}</span>
                                    <span class="quick-stat-label">Ürün</span>
                                </div>
                                <div class="quick-stat-item">
                                    <span class="quick-stat-value">{{ sahip_ilan_sayisi|default:0 }}</span>
                                    <span class="quick-stat-label">İlan</span>
                                </div>
                                <div class="quick-stat-item">
                            <span class="quick-stat-value">{{ user.petshop_profili.ortalama_puan|floatformat:1|default:"5.0" }}</span>
                                    <span class="quick-stat-label">Puan</span>
                                </div>
                    </div>

                    <div class="menu-group mb-3">
                                <div class="menu-group-title">Ana İşlemler</div>
                        <a class="nav-link" href="{% url 'petshop:petshop_paneli' %}">
                            <i class="fas fa-home"></i>Panelim
                                </a>
                        <a class="nav-link" href="{% url 'petshop:petshop_profilim' %}">
                            <i class="fas fa-user-circle"></i>Profilim
                                </a>
                                {% if sahip_ilan_sayisi > 0 %}
                        <a class="nav-link" href="{% url 'ilan:kullanici_ilanlari' %}">
                            <i class="fas fa-bullhorn"></i>İlanlarım
                            <span class="badge bg-primary ms-auto">{{ sahip_ilan_sayisi }}</span>
                                </a>
                                {% endif %}
                        <a class="nav-link" href="{% url 'shop:siparis_listesi' %}">
                            <i class="fas fa-box"></i>Siparişlerim
                                </a>
                    </div>

                    <hr class="my-3 border-white border-opacity-25">

                    <div class="menu-group mb-3">
                                <div class="menu-group-title">Web Sayfası</div>
                        <a class="nav-link" href="{% url 'petshop:web_sayfasi_duzenle' %}">
                            <i class="fas fa-globe"></i>Web Sayfamı Düzenle
                                </a>
                                {% if user.petshop_profili.web_aktif and user.petshop_profili.web_slug %}
                        <a class="nav-link" href="{% url 'petshop:web_sayfasi_gorunum' user.petshop_profili.web_slug %}" target="_blank">
                            <i class="fas fa-external-link-alt"></i>Sayfamı Görüntüle
                                </a>
                                {% endif %}
                    </div>

                    <hr class="my-3 border-white border-opacity-25">

                    <div class="menu-group mb-3">
                                <div class="menu-group-title">Diğer</div>
                        <a class="nav-link" href="{% url 'petshop:hesap_ayarlari' %}">
                            <i class="fas fa-cog"></i>Hesap Ayarları
                                </a>
                        <a class="nav-link text-danger" href="{% url 'user_logout' %}">
                            <i class="fas fa-sign-out-alt"></i>Çıkış Yap
                                </a>
                    </div>
                    {% endif %}
                {% endif %}
            {% endif %}
        </div>
    </div>

    <!-- Mobile Menu Offcanvas - Tam Ekran -->
    <div class="offcanvas offcanvas-start mobile-menu-offcanvas d-lg-none" tabindex="-1" id="mobileMenuOffcanvas">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title mb-0 text-white d-flex align-items-center">
                <i class="fas fa-bars me-2"></i>Menü
            </h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Kapat"></button>
        </div>
        <div class="offcanvas-body">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'anahtarlik:ev' %}">
                        <i class="fas fa-home"></i>Ana Sayfa
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'anahtarlik:qr_kunye_nasil_calisir' %}">
                        <i class="fas fa-question-circle"></i>Nasıl Çalışır?
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'shop:shop_home' %}">
                        <i class="fas fa-store"></i>Mağaza
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'ilan:ilan_listesi' %}">
                        <i class="fas fa-bullhorn"></i>İlanlar
                    </a>
                </li>
            </ul>

            <!-- Mobile Auth Actions -->
            <div class="mt-4 pt-4 border-top border-white border-opacity-25">
                {% if user.is_authenticated %}
                    <!-- İlan Ver Button (Authenticated Users) -->
                    {% if user.sahip %}
                    <a href="{% url 'ilan:sahip_ilan_verme_kontrol' %}" class="btn w-100 mb-3"
                        style="background: linear-gradient(135deg, #70C1B3 0%, #6FCF97 100%); color: white; border: none; padding: 14px; border-radius: 12px; font-weight: 600; font-size: 1rem;">
                        <i class="fas fa-plus-circle me-2"></i>İlan Ver
                    </a>
                    {% else %}
                    <a href="{% url 'ilan:ilan_olustur' %}" class="btn w-100 mb-3"
                        style="background: linear-gradient(135deg, #70C1B3 0%, #6FCF97 100%); color: white; border: none; padding: 14px; border-radius: 12px; font-weight: 600; font-size: 1rem;">
                        <i class="fas fa-plus-circle me-2"></i>İlan Ver
                    </a>
                    {% endif %}
                    {% else %}
                    <!-- Guest User Actions -->
                    <a href="{% url 'user_login' %}" class="btn w-100 mb-3"
                        style="background: linear-gradient(135deg, #5B9BD5 0%, #70C1B3 100%); color: white; border: none; padding: 14px; border-radius: 12px; font-weight: 600; font-size: 1rem;">
                        <i class="fas fa-sign-in-alt me-2"></i>Giriş Yap
                    </a>
                    <a href="{% url 'guest_register' %}" class="btn w-100 mb-3"
                        style="background: linear-gradient(135deg, #70C1B3 0%, #6FCF97 100%); color: white; border: none; padding: 14px; border-radius: 12px; font-weight: 600; font-size: 1rem;">
                        <i class="fas fa-bullhorn me-2"></i>İlan Ver
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>

    <!-- Shopping Cart Sidebar -->
    <div class="offcanvas offcanvas-end yan-menu" tabindex="-1" id="sepetYanMenu">
        <div class="offcanvas-header yan-menu-baslik d-flex align-items-center justify-content-between">
            <h5 class="offcanvas-title mb-0 text-white d-flex align-items-center">
                <i class="fas fa-shopping-cart me-2"></i>Sepetim
            </h5>
            <button type="button" class="kapat-dugmesi d-none d-lg-flex" data-bs-dismiss="offcanvas" aria-label="Kapat">
                <i class="fas fa-times"></i>
            </button>
            <button type="button" class="btn-close btn-close-white d-lg-none" data-bs-dismiss="offcanvas" aria-label="Kapat"></button>
        </div>
        <div class="offcanvas-body">
            {% if sepet_items %}
            <div class="mb-4">
                {% for item in sepet_items %}
                <div class="sepet-item d-flex align-items-start gap-3 mb-3">
                    <!-- Product Image -->
                    <div class="flex-shrink-0"
                        style="width: 60px; height: 60px; overflow: hidden; border-radius: 12px;">
                        {% if item.urun.resimler.first %}
                        <img src="{{ item.urun.resimler.first.resim.url }}" class="img-fluid h-100 w-100"
                            alt="{{ item.urun.ad }}" style="object-fit: cover;" loading="lazy" decoding="async">
                        {% else %}
                        <img src="{% static 'images/default-product.jpg' %}" class="img-fluid h-100 w-100"
                            alt="Varsayılan" style="object-fit: cover;" loading="lazy" decoding="async">
                        {% endif %}
                    </div>

                    <!-- Product Info -->
                    <div class="flex-grow-1">
                        <div class="d-flex justify-content-between align-items-start">
                            <h6 class="mb-1 text-white">{{ item.urun.ad }}</h6>
                            <span class="text-light small fw-bold">{{ item.subtotal|floatformat:2 }} TL</span>
                        </div>
                        <div class="d-flex justify-content-between align-items-center">
                            <small class="text-light opacity-75">Adet: {{ item.miktar }} | {{ item.urun.fiyat|floatformat:2 }} TL</small>
                            <a href="{% url 'shop:sepet_kalemi_sil' item.id %}" class="text-danger small ms-2 fs-6" title="Kaldır">
                                <i class="fas fa-trash-alt"></i>
                            </a>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- Total -->
            <div class="d-flex justify-content-between align-items-center mb-4 p-3 rounded"
                style="background: rgba(255, 255, 255, 0.2); backdrop-filter: blur(10px); border: 2px solid rgba(255, 255, 255, 0.3);">
                <h6 class="mb-0 text-white fw-bold">Toplam:</h6>
                <h5 class="mb-0 text-white fw-bold" style="font-size: 1.5rem;">{{ sepet_toplam|floatformat:2 }} TL</h5>
            </div>

            <!-- Action Buttons -->
            <div class="d-grid gap-3">
                <a href="{% url 'shop:sepet_goster' %}" class="btn w-100 sepet-action-btn"
                    style="background: linear-gradient(135deg, #70C1B3 0%, #6FCF97 100%); color: white; border: none; padding: 14px; border-radius: 12px; font-weight: 600; font-size: 1rem; text-decoration: none; display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                    <i class="fas fa-shopping-basket"></i>Sepeti Görüntüle
                </a>
                <a href="{% url 'shop:shop_home' %}" class="btn w-100 sepet-continue-btn"
                    style="background: rgba(255, 255, 255, 0.2); color: white; border: 2px solid rgba(255, 255, 255, 0.3); padding: 14px; border-radius: 12px; font-weight: 600; font-size: 1rem; text-decoration: none; display: flex; align-items: center; justify-content: center; gap: 0.5rem; transition: all 0.3s ease;">
                    <i class="fas fa-store"></i>Alışverişe Devam Et
                </a>
            </div>

            {% else %}
            <!-- Empty Cart -->
            <div class="sepet-bos">
                <i class="fas fa-shopping-cart fa-3x mb-3"></i>
                <p class="mb-1">Sepetiniz henüz boş</p>
                <small class="d-block mb-3">Harika ürünlerimizi keşfetmeye başlayın!</small>
                <a href="{% url 'shop:shop_home' %}" class="btn w-100 mt-3"
                    style="background: linear-gradient(135deg, #70C1B3 0%, #6FCF97 100%); color: white; border: none; padding: 14px; border-radius: 12px; font-weight: 600; font-size: 1rem; text-decoration: none; display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem; max-width: 300px; margin: 0 auto;">
                    <i class="fas fa-store"></i>Mağazaya Git
                </a>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Main Content -->
    <main>
        {% block icerik %}
        {% block content %}{% endblock %}
        {% endblock %}
    </main>

    <!-- Footer -->
    <footer class="alt-kisim">
        <div class="container">
            <div class="row">
                <div class="col-lg-4 mb-4 mb-lg-0">
                    <h5 class="mb-3 d-flex align-items-center">
                        <i class="fas fa-paw me-2" style="color: #FF8C42;"></i>
                        PetSafe Hub
                    </h5>
                    <div class="footer-about">
                        <p>Evcil dostlarınız için en iyi hizmet ve ürünleri sunuyoruz. Onların mutluluğu bizim
                            önceliğimiz.</p>
                    </div>
                    <div class="sosyal-simgeler d-flex mt-3">
                        <a href="#" title="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" title="Twitter"><i class="fab fa-twitter"></i></a>
                        <a href="#" title="Instagram"><i class="fab fa-instagram"></i></a>
                        <a href="#" title="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                    </div>
                </div>
                <div class="col-lg-4 col-md-6 mb-4 mb-md-0">
                    <h5 class="mb-3">Hızlı Linkler</h5>
                    <ul class="footer-links">
                        <li><a href="{% url 'anahtarlik:ev' %}">Ana Sayfa</a></li>
                        <li><a href="{% url 'anahtarlik:qr_kunye_nasil_calisir' %}">Nasıl Çalışır?</a></li>
                        <li><a href="{% url 'shop:shop_home' %}">Mağaza</a></li>
                        <li><a href="{% url 'ilan:ilan_listesi' %}">İlanlar</a></li>
                    </ul>
                </div>
                <div class="col-lg-4 col-md-6 mb-4 mb-md-0">
                    <h5 class="mb-3">Hizmetlerimiz</h5>
                    <ul class="footer-links">
                        <li><a href="{% url 'shop:etiket_list' %}">QR Künye Sistemi</a></li>
                        <li><a href="{% url 'veteriner:veteriner_paneli' %}">Veteriner Randevu</a></li>
                        <li><a href="{% url 'shop:shop_home' %}">Pet Shop</a></li>
                        <li><a href="{% url 'ilan:ilan_listesi' %}">Sahiplendirme</a></li>
                    </ul>
                </div>
            </div>
            <hr class="mt-4 mb-3" style="border-color: rgba(255,255,255,0.1);">
            <div class="row align-items-center">
                <div class="col-md-6 text-center text-md-start">
                    <p class="mb-0 opacity-75">© 2025 PetSafe Hub. Tüm hakları saklıdır.</p>
                </div>
                <div class="col-md-6 text-center text-md-end">
                    <p class="mb-0 opacity-75">Made with <i class="fas fa-heart text-danger"></i> for pets</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Scripts - Deferred for performance -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" defer></script>

    <!-- Dropdown Initialization Script -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Bootstrap dropdown'ları initialize et
            const dropdownToggles = document.querySelectorAll('[data-bs-toggle="dropdown"]');
            dropdownToggles.forEach(function (toggle) {
                try {
                    bootstrap.Dropdown.getOrCreateInstance(toggle);
                } catch (error) {
                    // Silent error handling
                }
            });
        });
    </script>
    <script src="https://unpkg.com/aos@next/dist/aos.js" defer></script>
    <script defer>
        // 🔄 Page Loader - Hide when page is ready
        (function() {
            const pageLoader = document.getElementById('pageLoader');
            
            function hideLoader() {
                if (pageLoader) {
                    pageLoader.classList.add('hidden');
                    // Remove from DOM after animation
                    setTimeout(() => {
                        pageLoader.remove();
                    }, 500);
                }
            }
            
            // Hide loader when page is fully loaded
            if (document.readyState === 'complete') {
                hideLoader();
            } else {
                window.addEventListener('load', hideLoader);
            }
            
            // Fallback: hide after 3 seconds max
            setTimeout(hideLoader, 3000);
        })();
        
        // AOS Animation - Deferred
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initAOS);
        } else {
            initAOS();
        }
        
        function initAOS() {
            if (typeof AOS !== 'undefined') {
                AOS.init({
                    duration: 1000,
                    once: true,
                    easing: 'ease-out-cubic',
                    offset: 50,
                    disable: window.matchMedia('(prefers-reduced-motion: reduce)').matches || window.innerWidth < 768
                });
            }
        }

        // Navbar scroll effect
        window.addEventListener('scroll', () => {
            const navbar = document.querySelector('.ust-menu');
            if (window.scrollY > 50) {
                navbar.classList.add('scrolled');
            } else {
                navbar.classList.remove('scrolled');
            }
        });

        // Smooth scrolling for anchor links
        document.querySelectorAll('a[href*="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                const href = this.getAttribute('href');

                if (href === '#' || href.indexOf('#') === -1) return;

                const targetId = href.substring(href.indexOf('#') + 1);
                const targetElement = document.getElementById(targetId);

                if (targetElement) {
                    e.preventDefault();

                    const headerOffset = 100;
                    const elementPosition = targetElement.getBoundingClientRect().top;
                    const offsetPosition = elementPosition + window.pageYOffset - headerOffset;

                    window.scrollTo({
                        top: offsetPosition,
                        behavior: 'smooth'
                    });
                }
            });
        });

        // Button interactions - Kaldırıldı (CSS hover yeterli)

        // Dropdown auto close on mobile ve body scroll kontrolü
        document.querySelectorAll('.dropdown-menu a').forEach(item => {
            item.addEventListener('click', function (e) {
                const dropdown = this.closest('.dropdown');
                if (dropdown && window.innerWidth < 992) {
                    const toggle = dropdown.querySelector('.dropdown-toggle');
                    if (toggle) {
                        setTimeout(() => {
                            const dropdownInstance = bootstrap.Dropdown.getInstance(toggle);
                            if (dropdownInstance) {
                                dropdownInstance.hide();
                            }
                            // Body scroll'u geri aç
                            document.body.style.overflow = '';
                        }, 100);
                    }
                }
            });
        });
        
        // Mobil profil dropdown açıldığında body scroll'u engelle ve pozisyonu düzelt
        // Mobile profil offcanvas için body scroll kontrolü
        const mobileProfilOffcanvas = document.getElementById('mobileProfilOffcanvas');
        if (mobileProfilOffcanvas) {
            mobileProfilOffcanvas.addEventListener('show.bs.offcanvas', function () {
                    document.body.style.overflow = 'hidden';
            });
            mobileProfilOffcanvas.addEventListener('hidden.bs.offcanvas', function () {
                    document.body.style.overflow = '';
            });
        }


        // User panel URL dynamic assignment
        document.addEventListener('DOMContentLoaded', function () {
            try {
                var link = document.querySelector('a[href*="kullanici_paneli"]');
                if (link && '{{ user_panel_url }}') {
                    link.setAttribute('href', '{{ user_panel_url }}');
                }
            } catch (e) { /* Silent error handling */ }
        });
    </script>

    <script src="{% static 'js/districts.js' %}"></script>
    
    <!-- 🔄 Loading State Helpers -->
    <script>
        // Button Loading State
        window.setButtonLoading = function(btn, loading = true) {
            if (!btn) return;
            
            if (loading) {
                btn.classList.add('btn-loading');
                btn.disabled = true;
                btn.dataset.originalText = btn.innerHTML;
            } else {
                btn.classList.remove('btn-loading');
                btn.disabled = false;
                if (btn.dataset.originalText) {
                    btn.innerHTML = btn.dataset.originalText;
                }
            }
        };
        
        // Form Loading State
        window.setFormLoading = function(form, loading = true) {
            if (!form) return;
            
            if (loading) {
                form.classList.add('form-loading');
                form.querySelectorAll('button, input, select, textarea').forEach(el => {
                    el.disabled = true;
                });
            } else {
                form.classList.remove('form-loading');
                form.querySelectorAll('button, input, select, textarea').forEach(el => {
                    el.disabled = false;
                });
            }
        };
        
        // Content Loading State
        window.setContentLoading = function(element, loading = true) {
            if (!element) return;
            element.classList.toggle('content-loading', loading);
        };
        
        // Auto-loading for forms with data-auto-loading attribute
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('form[data-auto-loading]').forEach(form => {
                form.addEventListener('submit', function() {
                    const submitBtn = form.querySelector('[type="submit"]');
                    if (submitBtn) {
                        setButtonLoading(submitBtn, true);
                    }
                    setFormLoading(form, true);
                });
            });
            
            // Auto-loading for buttons with data-loading attribute
            document.querySelectorAll('[data-loading]').forEach(btn => {
                btn.addEventListener('click', function() {
                    setButtonLoading(this, true);
                });
            });
        });
    </script>
    
    {% block js_dosyalar %}{% endblock %}

    <!-- Toast Messages -->
    {% if messages %}
    <div class="toast-container position-fixed top-0 end-0 p-3"
        style="margin-top: 100px; z-index: 1100; display:flex; flex-direction:column; gap:12px;">
        {% for message in messages %}
        <div class="toast toast-modern show bg-{% if message.tags %}{{ message.tags }}{% else %}success{% endif %} text-white"
            role="status" aria-live="polite" aria-atomic="true" data-delay="5000">
            <div class="toast-content">
                <div class="toast-icon">
                    <i
                        class="fas {% if message.tags == 'info' %}fa-info-circle{% elif message.tags == 'warning' %}fa-exclamation-triangle{% elif message.tags == 'error' %}fa-times-circle{% else %}fa-check-circle{% endif %}"></i>
                </div>
                <div>
                    <div class="toast-title">{% if message.level_tag %}{{ message.level_tag|title }}{% endif %}</div>
                    <div class="toast-message">{{ message }}</div>
                </div>
                <button type="button" class="btn-close btn-close-white ms-3" aria-label="Kapat"></button>
            </div>
            <div class="toast-progress" style="transform: scaleX(1);"></div>
        </div>
        {% endfor %}
    </div>
    <script>
        // Modern toast helper: initialize bootstrap toasts + progress bar + pause on hover
        document.addEventListener('DOMContentLoaded', function () {
            const toasts = Array.from(document.querySelectorAll('.toast-modern'));
            toasts.forEach(function (t) {
                const delay = parseInt(t.getAttribute('data-delay')) || 5000;
                const progress = t.querySelector('.toast-progress');
                const closeBtn = t.querySelector('.btn-close');

                // bootstrap integration for ARIA behavior
                const bsToast = new bootstrap.Toast(t, { autohide: true, delay: delay });
                bsToast.show();

                // animate progress bar using JS to allow pause on hover
                if (progress) {
                    let start = Date.now();
                    let remaining = delay;
                    let rafId = null;

                    function step() {
                        const elapsed = Date.now() - start;
                        const ratio = Math.max(0, 1 - elapsed / delay);
                        progress.style.transform = 'scaleX(' + ratio + ')';
                        if (ratio > 0) rafId = requestAnimationFrame(step);
                    }

                    function startProgress() {
                        start = Date.now();
                        rafId = requestAnimationFrame(step);
                    }

                    function stopProgress() {
                        if (rafId) cancelAnimationFrame(rafId);
                    }

                    // start
                    startProgress();

                    // pause on hover
                    t.addEventListener('mouseenter', function () {
                        stopProgress();
                    });
                    t.addEventListener('mouseleave', function () {
                        // resume with remaining time
                        start = Date.now() - (delay * (1 - parseFloat(progress.style.transform.replace('scaleX(', '').replace(')', ''))));
                        rafId = requestAnimationFrame(step);
                    });
                }

                // close button
                if (closeBtn) {
                    closeBtn.addEventListener('click', function () {
                        try { bsToast.hide(); } catch (e) { t.remove(); }
                    });
                }
            });
        });
    </script>
    {% endif %}
</body>

</html>